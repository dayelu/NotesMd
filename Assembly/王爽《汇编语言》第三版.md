[TOC]

# 1. 基础知识
## 1.1 机器语言
### 1.1.1 概念

机器语言是机器指令的集合。电子计算机的机器指令是一列二进制数字。计算机将之转换为一列高低电平以使计算机的电子期间受到驱动进行运算。

## 1.2 汇编语言
### 1.2.1 概念
1. 机器语言难以记忆和书写，与汇编语言产生。汇编语言主体是汇编指令，与机器语言的区别在于表达方法上。
2. 汇编语言由编译器翻译成机器码交给计算机执行。

### 1.2.2 语言成分
汇编语言由以下三部分组成：

1. 汇编指令：机器码对应的助记符，**有对应的机器码**。
2. 伪指令：没有对应的机器码，由编译器执行，计算机不执行。
3. 其他符号：如 `+、-、*、\` 等符号，由编译器识别，没有对应的机器码。

## 1.3 其他基本概念
1. 内存：

   1. 数据和指令存在的位置。
   2. 内存不是磁盘的容量（比如 1 TB 的硬盘），磁盘上的数据或程序如果不读入内存就无法被 CPU 使用。
   3. 每个存储器被划分为若干个存储单元，每个存储单元从 0 开始编号。

2. 计算机的最小 **信息单位** 是 **bit**（比特），一个二进制位。

3. 计算机最小的 **存储单位** 是 **Byte**，称一个 **字节**。

4. **两个字节为一个字**（word），刚好为一个 8086 CPU 寄存器的位数（16位）。

5. 单位换算：

   **8  bit = 1 Byte**

   **2 Byte = 1 Word**

   **1 KB = 1024 Byte**

   **1 MB = 1024 KB**

   **1 GB = 1024 MB**

   **1 TB = 1024 GB**

6. 内存地址空间：地址总线宽度下，可寻址范围极为 CPU 的内存地址空间。例如，一个 CPU 的地址总线宽度为 10 ,那么可寻址 $2^{10}$ 个内存单元。这 1024 个内存单元即是 CPU 的内存地址空间。

7. CPU 不能直接对外设进行控制，直接控制外设的是与这些外设相连接的扩展插槽上的接口卡。扩展插槽和接口卡通过总线与 CPU 相连，**CPU 通过 接口卡间接控制外设**。某些接口上装有 RAM，用来对大批量输入输出的数据进行暂存，例如显卡的显存。更多 CPU 控制外设的内容在后续外中断章节还会提到。

   

## 1.4 CPU 对存储器的读写

1. 必要条件：

   CPU 对存储器进行读写需要其他芯片提供以下三类信息：

   - 存储单元的地址信息
   - 器件的选择，读写命令。（控制信息）
   - 读写的数据信息。

2. 读写过程（仅以读为例）

   - CPU 通过地址总线将地址信息 3 发出。
   - CPU 通过控制总线发出读内存命令，选中存储器芯片，并通知它将要从中读取数据。
   - 存储器将 3 号单元的数据 8 通过数据线送入 CPU.

- 示意图（CPU 从三号单元读取数据的过程）
![1.4](%E7%8E%8B%E7%88%BD%E3%80%8A%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E3%80%8B%E7%AC%AC%E4%B8%89%E7%89%88/1.4.png)



## 1.5 总线

### 1.5.1 概念[^1]

  总线（Bus）是计算机各种功能部件之间传送信息的公共通信干线，它是由[导线](https://baike.baidu.com/item/导线/1413914)组成的传输线束， 按照计算机所传输的信息种类，计算机的总线可以划分为[数据总线](https://baike.baidu.com/item/数据总线/272650)、[地址总线](https://baike.baidu.com/item/地址总线/4307936)和[控制总线](https://baike.baidu.com/item/控制总线/272568)，分别用来传输数据、数据地址和[控制信号](https://baike.baidu.com/item/控制信号/10329713)。总线是一种内部结构，它是cpu、内存、输入、[输出设备](https://baike.baidu.com/item/输出设备/10823333)传递信息的公用通道，[主机](https://baike.baidu.com/item/主机/455151)的各个部件通过总线相连接，[外部设备](https://baike.baidu.com/item/外部设备)通过相应的接口电路再与总线相连接，从而形成了[计算机硬件系统](https://baike.baidu.com/item/计算机硬件系统/8092895)。在计算机系统中，**各个部件之间传送信息的公共通路叫总线**，[微型计算机](https://baike.baidu.com/item/微型计算机/9287)是以[总线结构](https://baike.baidu.com/item/总线结构/10183496)来连接各个[功能部件](https://baike.baidu.com/item/功能部件/8514356)的。

### 1.5.2 逻辑分类

  从逻辑上分为以下三类：地址总线，控制总线，数据总线。

- **地址总线**：CPU 通过地址总线指定存储器单元。地址总线的宽度决定 CPU 的寻址范围。（更多有关地址总线的问题在后面寻址有关问题再讨论）

- **数据总线**：CPU 与 内存之间的数据传送通过数据总线进行传送。数据总线的宽度决定了 CPU 和 外界的数据传输速度。例如，8 根数据总线一次可以传输 一个字节的数据。

- **控制总线**：CPU 通过 控制总线控制外部器件。控制总线决定对外部器件的控制能力（能控制多少外部器件）。控制总线的方向是双向的，CPU 通过控制总线发送控制信息给其他器件，反之其他器件也通过控制总线发送反馈信息给  CPU.

### 1.5.3 南北桥芯片

  南北桥芯片是主板上的**总线控制器芯片**。

![1.5.3](%E7%8E%8B%E7%88%BD%E3%80%8A%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E3%80%8B%E7%AC%AC%E4%B8%89%E7%89%88/1.5.3.png)

- 北桥芯片：

  北桥芯片通过前端总线直接与 CPU相连。用于高速信号，CPU 信号，RAM信号和 GPU 信号。AMD 在 K8 系列后将内存控制器集成在 CPU 中，因此 AMD系的主板上的北桥芯片不再控制内存。

- 南桥芯片


##  1.6 内存地址空间

- 基本概念：

  所有的物理存储器都被 CPU 看作**一个**由若干存储单元组成的**逻辑存储器**，也即**内存地址空间**。每个物理存储器在这个逻辑存储器中都有一个地址段，即一段地址空间。示意图如下：

- CPU 的逻辑存储器

  ![1.6](%E7%8E%8B%E7%88%BD%E3%80%8A%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E3%80%8B%E7%AC%AC%E4%B8%89%E7%89%88/1.6.png)

- 限制因素：

  内存地址空间的大小受**地址总线宽度**的限制，8086 CPU 的地址**总线宽度为 20**，即 20 跟地址线，可表示从 1 到 ($2^{20}$ -1) 的 $2^{20}$ 个不同的地址信息，即可**定位 $2^{20}$  个内存单元**，也即**可寻址** $2^{20}$  个地址空间**，则其内存地址空间大小为 1 MB**，**寻址能力**为 **1 MB**。



# 2. 寄存器

## 2.1 CPU 内部基本构造

CPU 的由运算器、寄存器、控制器等器件组成，这些器件靠**内部总线**相连，**外部总线**实现 CPU 和主板上其他器件的联系。CPU内部工作原理简单总结如下：

- 运算器进行信息处理。

- 寄存器进行信息存储。

- 控制器控制各种器件进行工作。

- 内部总线连接各种器件，在他们直接发送数据。

  

## 2.2 寄存器分类一览

来源 : [8086CPU各寄存器及其简介](https://blog.csdn.net/weixin_40913261/article/details/90762210)



**8086 CPU 中寄存器总共为 14 个，且均为 16 位 。**

即 **AX，BX，CX，DX，SP，BP，SI，DI，IP，FLAG，CS，DS，SS，ES** 共 14 个。

而这 14 个寄存器按照一定方式又分为了通用寄存器，控制寄存器和段寄存器。

### 2.2.1 通用寄存器

**数据寄存器：AX，BX，CX，DX **[^2]

| 标识 | 名称 |
| :--: |:--: |
|**AX** (Accumulator) | 累加寄存器，也称之为累加器 |
|**BX** (Base) | 基地址寄存器 |
|**CX** (Count) | 计数器寄存器 |
|**DX** (Data) | 数据寄存器 |



**指针寄存器：SP 和 BP **

|          标识          |      名称      |
| :--------------------: | :------------: |
| **SP** (Stack Pointer) | 堆栈指针寄存器 |
| **BP** (Base Pointer)  |  基指针寄存器  |

**变址寄存器：SI 和 DI **

|            标识            |      名称      |
| :------------------------: | :------------: |
|   **SI** (Source Index)    |  源变址寄存器  |
| **DI** (Destination Index) | 目的变址寄存器 |



### 2.2.2 段寄存器

|          标识          |     名称     |
| :--------------------: | :----------: |
| **CS** (Code Segment)  | 代码段寄存器 |
| **DS** (Data Segment)  | 数据段寄存器 |
| **SS** (Stack Segment) | 堆栈段寄存器 |
| **ES** (Extra Segment) | 附加段寄存器 |



### 2.2.3 控制寄存器

|             标识             |      名称      |
| :--------------------------: | :------------: |
| **IP** (Instruction Pointer) | 指令指针寄存器 |
|           **FLAG**           |   标志寄存器   |



## 2.3 寄存器的逻辑结构

- 以数据寄存器 **AX** 为例

![2.3](%E7%8E%8B%E7%88%BD%E3%80%8A%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E3%80%8B%E7%AC%AC%E4%B8%89%E7%89%88/2.3.png)

- 2进制和16进制的转换：

  **四位二进制数 等于 一位十六进制数**。因为四位二进制数可表示从0到 $2^{4}-1$ 即 15 以内的任意一个整数，一位十六进制数可表示的范围为0到15，刚好可以一一对应。因此，一个十六位二进制数可由四位十六进数表示。

- 在 8086 CPU 中，每个寄存器都是十六位。其中 **AX，BX，CX，DX** 四个 **数据寄存器** 由于向前兼容的原因可以分成**两个独立的 8 位寄存器**。如上图 **AX** 可以分成 一个 **AH** 寄存器，用来存储 **AX** 的 **高八位**称为**高位字节**，一个 **AL** 寄存器，用来存放 **AX** 的 **低八位**称为**低位字节**。类似的还有如下几种情况：
  - **BX** 可以分为 **BL** 和 **BH**；
  - **CX** 可以分为 **CL** 和 **CH**；
  - **DX** 可以分为 **DL** 和 **DH**；

- 在使用寄存器时需要注意以下几点：
  1. 一个寄存器只能存入其位数可表示范围以内的数据。例如，一个 **AX** 寄存器能存储的最大整数为 $2^{16}-1$ ，一个 **AL** 寄存器最大能存储的整数为 $2^{8}-1$.
  2. 在使用汇编指令如果操作对象由两个时，需要注意**两个操作对象的位数必须一致**。
  3. 在使用数据寄存器时需要注意，以 **AX** 为例，**AH** 和 **AL** 是两个 **独立** 的寄存器，**AL** 独立参与操作后得到的进位不会保存在 **AH**中，而是被舍去。如果 **AX** 参与操作此时第八位产生的进位会存储在高八位之中，此时 **AX** 相对于 **AH** 和 **AL** 而言也是一个独立的寄存器。



## 2.4 物理地址

### 2.4.1 基本概念

- 定义：

  前面说到，CPU 将所有的物理存储器看一个由若干个存储单元组成的 **逻辑存储器**。所有的内存单元构成的存储单元是一个 **一维的线性空间**。每一个内存单元在这个一维的地址空间，这个地址被称为 **物理地址**。

- 16 位结构的 CPU：

  - 运算器一次最多可以处理 16位的数据；
  - 寄存器的最大宽度为 16位；
  - 寄存器和运算器之间的通路为 16位。

- **8086 CPU 有20跟地址线可表示 $2^{20}$ 个物理地址，即具有 1 MB 的寻址能力。**



- *扩展：*
  - x 位 CPU的说法是一种商业的叫法，并不是严格的专业术语。不同架构的 CPU对此亦有不同的定义标准。比如 CISC 架构的 x86 指令集的32位和64位就与 RSIC 架构的 ARM指令集的32位和64并相同。
  - 32位CPU通常有32个地址总线，其寻址能力为 $2^{32}$，即 **4 GB**. 由于 32位架构的 CPU寻址能力的限制，此架构的 CPU的计算机并不能利用大于其寻址能力以外的物理地址。
  - x86架构指的是以8086指令集为基础后进行一系列扩展的指令的集合，其特点是向下兼容[^3]。x86-32指的是 x86架构的32位扩展。
  - x86-64架构也被称为 AMD64架构，这是由于x86架构的64位扩展是由 AMD公司率先一步实现的。Inter 公司曾自研过不兼容 x86 架构的 IA-64，但由于x86 已形成的强大生态，IA-64日渐式微，AMD64架构最终也被Inter 采用。
  - x 位的操作系统指的是支持 x 位的操作系统，其针对特定 x 位的 CPU 进行设计。

### 2.4.2 8086 CPU 给出物理地址的方法















[^1]: 本参考书出于教学考虑，将总线简单定义为 “连接CPU和其他芯片的导线”，不能解答某些疑问，故引用百科[总线](https://baike.baidu.com/item/%E6%80%BB%E7%BA%BF)词条。
[^2]: 此分类与本参考书略微不同，本参考书描述上似乎将通用寄存器的范围限制在本小节所参考博文 [8086CPU各寄存器及其简介](https://blog.csdn.net/weixin_40913261/article/details/90762210)的数据寄存器之内，与百科锁定并由[“科普中国”科学百科词条编写与应用工作项目](https://baike.baidu.com/science) 所审核的 [通用寄存器](https://baike.baidu.com/item/%E9%80%9A%E7%94%A8%E5%AF%84%E5%AD%98%E5%99%A8/283978?fr=aladdin) 词条不一致，遂以更符合权威部门所审定的参考博文为主。

[^3]:一个程序或者类库更新到较新的版本后，用旧的版本程序创建的文档或系统仍能被正常操作或使用，或在旧版本的类库的基础上开发的程序仍能正常编译运行的情况。--百度词条[向下兼容](https://baike.baidu.com/item/%E5%90%91%E4%B8%8B%E5%85%BC%E5%AE%B9?fromtitle=%E5%90%91%E5%90%8E%E5%85%BC%E5%AE%B9&fromid=94553)。

